# PRD分析报告

## 1. 文档概览

产品名称：产品品质保障—品质不合格门店拒绝维修后的设备锁定
版本号：V1.9（2025年10月份）
分析日期：2023-11-07
核心目标：通过监控门店对IOT触发的品质报修配合度，对不配合维修的门店进行设备锁定，以提高产品品质、消费者体验和总部对门店的管控能力。

## 2. 功能模块梳理

* 设备监控模块
  * IOT自动触发影响咖啡品质的报修（极值率异常、下限风味率异常、不合格风味率异常、设备离线）
  * 自动记录设备异常日志
  * 在线率统计
  * 制作合格标准监控
* 门店维修管理模块
  * 维修需求单创建（IOT自动发起、门店手动发起）
  * 总部推送维修方案
  * 门店确认/拒绝维修方案
  * 自动检测门店4天内不响应情况
  * 售后工单管理（待接单、待服务、服务中、待确认服务结果、待结算、已完成、已取消）
* 设备锁定/解锁模块
  * 对不配合维修的门店设备进行锁定（Frank及咖乐美咖啡机支持）
  * 设备锁定后限制制作饮品功能
  * 工程师调试解锁
  * 排查无问题或维修完成后解锁设备
* 灰度测试支持模块
  * 按城市维度进行灰度测试
* 资产列表管理模块
  * 资产状态管理（主状态、维修状态、保养状态）
  * 资产查询与筛选
  * 资产操作（新增、批量新增、调拨、报废、回收、灭失、修改SN码、修改质保日期）
  * 资产管制/解除管制操作
* 工单APP操作模块（工作站APP）
  * 工单列表查询
  * 工单接单/拒单
  * 申请改派
  * 开始服务（位置校验、配件校验）
  * 提交服务结果（维修结果、故障原因、未完成原因、服务说明、配件使用、现场照片）

## 3. 需求明细与逻辑澄清

| 功能点 | 业务逻辑/用户流程 | 输入/前置条件 | 输出/后置结果 | 业务规则与约束 | 待澄清点/风险 |
|-------|-----------------|--------------|-------------|--------------|--------------|
| IOT触发报修 | 1. IOT设备检测到异常<br>2. 自动生成维修需求单<br>3. 记录报修日志 | IOT设备检测到极值率异常、下限风味率异常、不合格风味率异常或设备离线 | 1. 生成维修需求单<br>2. 记录报修日志<br>3. 资产维修状态变为"待维修" | 报修日志需包含异常类型、异常值、时间、资产使用主体、资产所在等信息 | 【待澄清】：具体的异常阈值标准是什么？ |
| 门店不配合维修监控 | 1. 维修需求单创建<br>2. 总部推送维修方案<br>3. 系统监控门店响应 | 维修需求单状态为"待诊断/方案确认中" | 系统识别出门店不配合维修的情况 | 1. 门店直接拒绝维修方案<br>2. 门店4天内不确认不拒绝 | 【待澄清】：维修方案的具体内容和推送方式是什么？ |
| 设备锁定 | 1. 系统识别出门店不配合维修<br>2. 系统对设备进行锁定<br>3. 记录管制日志 | 门店不配合维修的判定结果 | 1. 设备被锁定<br>2. 设备无法正常制作饮品<br>3. 资产管制情况变为"已管制"<br>4. 记录管制日志 | 1. 仅Frank及咖乐美咖啡机支持管制<br>2. 锁定后设备功能受限<br>3. 管制日志需包含管制时间、操作人、管制原因等信息 | 【待澄清】：锁定后具体哪些功能不可用？<br>【待澄清】：管制原因的具体内容是什么？ |
| 设备解锁 | 1. 工程师在APP端发起调试<br>2. 系统对设备进行解锁<br>3. 记录解除管制日志 | 设备管制情况为"已管制"，工单状态为"服务中" | 1. 设备被解锁<br>2. 设备恢复正常制作饮品功能<br>3. 资产管制情况变为"未管制"<br>4. 记录解除管制日志 | 1. 解锁后设备功能恢复<br>2. 解除管制日志需包含解除管制时间、操作人等信息 | 【待澄清】：排查无问题的确认流程是什么？ |
| 灰度测试 | 按城市维度进行灰度测试 | 灰度测试配置 | 系统按配置进行灰度发布 | 按照城市维度进行灰度 | 【待澄清】：灰度测试的具体实施方案是什么？<br>【待澄清】：灰度测试的评估标准是什么？ |
| 资产状态管理 | 资产主状态、维修状态、保养状态的自动流转 | 各种触发事件（安装完成、维修工单状态变更、保养工单状态变更、手动操作等） | 资产状态的自动更新 | 详细的状态流转规则见文档 | 无 |
| 工单管理（APP端） | 工程师接单、拒单、申请改派、开始服务、提交服务结果 | 工单分派给工程师，工单状态满足条件 | 工单状态的更新，服务结果的记录 | 1. 接单/拒单有严格的状态限制<br>2. 开始服务需要位置校验和配件校验<br>3. 提交服务结果需要填写维修结果、故障原因、现场照片等信息 | 无 |

## 4. 非功能性需求梳理

* 性能：
  * 系统需要实时响应IOT设备的报修信息（极值率、风味率等异常）
  * 及时处理门店的响应
  * 上线前需要清洗6W+线上数据
* 兼容性：
  * 需要支持不同品牌的咖啡机（咖乐美咖啡机、Frank咖啡机）
  * 需要兼容租赁设备和自有设备
* 可靠性：
  * 设备锁定/解锁操作需要高度可靠，避免误操作
  * 确保工单状态流转的一致性和准确性
* 可观测性：
  * 需要记录所有锁定/解锁操作的详细日志，便于追溯
  * 需要记录所有资产操作的管理日志
* 安全性：
  * 所有操作需要控制权限
  * 确保设备锁定/解锁的安全性，避免未授权操作
* 数据一致性：
  * 确保资产信息、工单信息、设备状态信息的一致性
  * 配件库存校验机制确保库存数据的准确性

## 5. 测试视角分析

主要测试场景：
* IOT触发报修（极值率异常） -> 生成维修需求单 -> 资产维修状态变为"待维修" -> 门店拒绝维修方案 -> 设备锁定 -> 工程师调试解锁
* IOT触发报修（设备离线） -> 生成维修需求单 -> 资产维修状态变为"待维修" -> 门店4天不响应 -> 设备锁定 -> 工程师维修完成 -> 设备解锁
* 门店手动发起报修 -> 生成维修需求单 -> 总部推送方案 -> 门店确认 -> 工程师接单 -> 开始服务 -> 提交服务结果 -> 工单完成
* 灰度测试场景：配置不同城市的灰度测试策略，验证系统是否按预期进行灰度发布
* 资产操作场景：新增资产、批量新增资产、调拨、报废、回收、灭失等操作的正确性

边界与异常用例：
* 门店在4天内部分确认部分拒绝的情况
* 设备锁定过程中网络中断的情况
* 不同品牌咖啡机（Frank、咖乐美）的锁定/解锁兼容性测试
* 灰度测试过程中切换灰度策略的情况
* 工程师开始服务时位置不在门店周边100m内的情况
* 工程师开始服务时配件未确认收货的情况
* 提交服务结果时现场照片上传失败的情况
* 设备主状态、维修状态、保养状态的异常流转情况

待测数据/配置：
* 不同城市的门店数据
* 不同品牌的咖啡机数据（Frank、咖乐美）
* 各种可能的报修类型（极值率异常、下限风味率异常、不合格风味率异常、设备离线）
* 各种工单状态数据
* 租赁设备和自有设备数据
* 不同权限的用户账号（区域经理、工程师）

## 6. 研发视角分析

关键依赖：
* IOT设备数据采集系统：获取设备运行状态、异常数据
* 咖啡机控制系统：与不同品牌咖啡机（Frank、咖乐美）进行交互，实现设备锁定/解锁
* 门店管理系统：获取门店信息、门店状态
* 工程师管理系统：获取工程师信息、工程师状态、位置信息
* 资产管理系统：管理资产信息、资产状态
* 工单管理系统：管理维修工单、保养工单、安装工单的全生命周期
* 库存管理系统：校验配件库存
* 配置中心：管理各种枚举值、配置项（如位置校验范围、兼容的咖啡机品牌等）

潜在技术挑战：
* 如何识别和适配不同品牌的咖啡机（咖乐美咖啡机、Frank咖啡机）的锁定/解锁机制
* 确保设备锁定/解锁操作的安全性、可靠性和实时性
* 设计灵活的灰度测试机制，支持按城市维度进行灰度发布和回滚
* 处理大量IOT设备数据的实时采集、处理和分析
* 确保资产状态、工单状态的一致性和准确性
* 设计高效的查询和筛选机制，支持复杂的资产查询条件

数据模型/API初步设想：
* 资产模型：资产ID、资产名称、资产SN码、资产追踪码、资产类型、资产所属主体、资产使用主体、资产所在、资产主状态、维修状态、保养状态、管制情况、质保截止日期等
* 报修记录模型：报修ID、资产ID、报修类型、触发时间、异常描述、门店信息等
* 维修工单模型：工单ID、资产ID、工单类型、工单状态、执行人、预计上门时间、维修结果、故障原因、服务说明、现场照片等
* 设备锁定记录模型：记录ID、资产ID、锁定时间、锁定原因、操作人、解锁时间、解锁原因、解除操作人等
* API接口：
  * 设备锁定API：支持按资产ID锁定设备
  * 设备解锁API：支持按资产ID解锁设备
  * 维修需求单创建API：支持IOT自动创建和门店手动创建
  * 工单状态更新API：支持接单、拒单、开始服务、提交服务结果等操作
  * 资产状态查询API：查询资产的各种状态
  * 灰度测试配置API：配置和管理灰度测试策略
  * 配件库存校验API：校验工程师个人仓配件库存

## 7. 总结与待办事项

关键结论：
本次分析的核心发现是，该功能的核心流程是通过IOT触发报修（极值率异常、下限风味率异常、不合格风味率异常、设备离线等），然后监控门店对维修的配合度（直接拒绝或4天内不响应），对不配合的门店进行设备锁定（Frank及咖乐美咖啡机支持）。新获取的文档补充了大量细节，包括资产状态管理、工单APP操作流程、详细的报修规则和日志记录要求等，但仍有一些关键的实现细节需要进一步明确。

待办事项清单：
* [ ] 确认IOT触发报修的具体阈值标准（极值率、风味率等异常的具体数值）
* [ ] 明确设备锁定/解锁的具体技术实现方式
* [ ] 确认维修方案的具体内容和推送方式
* [ ] 明确锁定后具体哪些功能不可用
* [ ] 明确管制原因的具体内容
* [ ] 确认排查无问题的确认流程
* [ ] 明确灰度测试的具体实施方案和评估标准
* [ ] 确认按城市灰度测试上线的具体策略
* [ ] 确认上线前6W+线上数据的清洗方案